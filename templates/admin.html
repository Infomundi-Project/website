{% extends "base.html" %} {% block title %}Admin Panel{% endblock %}
{% block styles %}
<style>
  .form-group {
  padding-bottom: 10px;
  }
</style>
{% endblock %}
{% block content %}
<div class="row mt-3">
  <div class="col-md-4 mb-3">
    <div class="card border border-success-subtle" style="max-width: 30rem;">
      <div class="card-header">
        <i class="fa-solid fa-rss"></i> Add News Feed
      </div>
      <div class="card-body">
        <form method="post" action="{{ url_for('api.add_news') }}">
          <div class="form-group">
            <label for="country"><i class="fa-solid fa-earth-americas"></i> Country</label>
            <input type="text" class="form-control autocomplete" id="country" name="country" required>
          </div>
          <div class="form-group">
            <label for="category"><i class="fa-solid fa-sitemap"></i> Category</label>
            <select class="form-control" id="category" name="category" required>
              <option value="general">General</option>
              <option value="politics">Politics</option>
              <option value="economy">Economy</option>
              <option value="technology">Technology</option>
              <option value="sports">Sports</option>
            </select>
          </div>
          <div class="form-group">
            <label for="site"><i class="fa-solid fa-satellite"></i> Feed Name</label>
            <input type="text" class="form-control" id="site" name="site" required>
          </div>
          <div class="form-group">
            <label for="url"><i class="fa-solid fa-link"></i> Feed URL</label>
            <input type="url" pattern="https?://.+" class="form-control" id="url" name="url" required>
          </div>
          <button type="submit" class="btn btn-outline-success"><i class="fa-solid fa-plus"></i> Add</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-4 ms-auto">
    <div class="card border border-primary-subtle" style="max-width: 30rem;">
      <div class="card-header">
        <i class="fa-solid fa-magnifying-glass"></i> Search Comments
      </div>
      <div class="card-body">
        <form method="post" action="{{ url_for('auth.search_comments') }}">
          <div class="form-group">
            <label for="search_text">Search Text</label>
            <input type="text" class="form-control" id="search_text" name="search_text" required>
          </div>
          <button type="submit" class="btn btn-outline-primary"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="row mt-3">
  <div class="col-md-4 mb-3">
    <div class="card border border-primary-subtle" style="max-width: 30rem;">
      <div class="card-header">
        <i class="fa-solid fa-magnifying-glass"></i> Search Info About a Country
      </div>
      <div class="card-body">
        <form method="post" action="{{ url_for('auth.get_feed_info') }}">
          <div class="form-group">
            <label for="country_name">Country Name</label>
            <input type="text" class="form-control autocomplete" id="country_name" name="country_name" required>
          </div>
          <button type="submit" class="btn btn-outline-primary"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-md-4 ms-auto">
    <div class="card border border-danger-subtle" style="max-width: 30rem;">
      <div class="card-header">
        <i class="fa-regular fa-trash-can"></i> Delete a Comment
      </div>
      <div class="card-body">
        <form method="post" action="{{ url_for('api.delete_comment') }}">
          <div class="form-group">
            <label for="comment_id">Comment ID</label>
            <input type="text" class="form-control" id="comment_id" name="comment_id" required>
          </div>
          <button type="submit" class="btn btn-outline-danger"><i class="fa-regular fa-trash-can"></i> Delete</button>
        </form>
      </div>
    </div>
  </div>
  {% if search_results %}
  <div class="col-md-4 ms-auto mb-3">
    <!-- Display search results in a new card -->
    <div class="card border border-info-subtle" style="max-width: 30rem;">
      <div class="card-header">
        <i class="fa-solid fa-square-poll-horizontal"></i> Search Results
      </div>
      <div class="card-body">
        <ul class="list-group">
          {% for result in search_results %}
          <li class="list-group-item">
            <i class="fa-solid fa-user"></i> User: {{ result['name'] }}<br>
            <i class="fa-solid fa-comment"></i> Comment: {{ result['text'] }}<br>
            <i class="fa-solid fa-arrow-up-right-from-square"></i> <a class="text-reset" href="{{ result['link'] }}" target="_blank">Link</a><br>
            <i class="fa-solid fa-fingerprint"></i> ID: {{ result['id'] }}
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  {% endif %}
</div>
<div class="col mt-3">
  <div class="form-check form-switch">
    <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckChecked" name="flexSwitchCheckChecked">
    <label style="padding-right: 10px" class="form-check-label" for="flexSwitchCheckChecked">Allow new comments</label>
    <button type="button" class="btn btn-outline-primary btn-sm" id="applyButton">Apply</button>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script 
  src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js" 
  integrity="sha256-eTyxS0rkjpLEo16uXTS0uVCS4815lc40K2iVpWDvdSY=" 
  crossorigin="anonymous"
  ></script>
<script 
  src="{{ url_for('static', filename='js/autocompleteNoRedirect.js') }}"
  ></script>
<script>
  $(document).ready(function() {
      // Fetch the initial state from the server
      $.ajax({
          url: "{{ url_for('api.get_comments_status') }}",
          method: 'GET',
          success: function(response) {
              $('#flexSwitchCheckChecked').prop('checked', response.enabled);
          }
      });
  
      // Handle the Apply button click
      $("#applyButton").click(function() {
          $.ajax({
              url: "{{ url_for('api.disable_comments') }}",
              method: 'POST',
              data: { 'flexSwitchCheckChecked': $('#flexSwitchCheckChecked').prop('checked') },
              success: function(response) {
                  // Handle any response if needed
                  console.log(response);
              }
          });
      });
  });
</script>
{% endblock %}
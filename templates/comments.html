{% extends "base.html" %} {% block title %}{{ story.title.capitalize() }}{% endblock %}
{% block styles %}
<style>
  .news-top-image{
    width: 50%;
    height: auto
  }

  @media (max-width: 600px) {
    .news-top-image{
      width: 100%;
    }
  }
  .blurred-text {
    width: 80%;
    margin-bottom: 20px;
    font-size: 18px;
    color: transparent;
    text-shadow: 0 0 5px rgba(0,0,0,0.5);
    line-height: 1.6;
    height: 100px; /* Adjust height as needed */
    overflow: hidden;
    position: relative;
}

.loading-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 2px solid #ccc;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.mascot {
    width: 100px;
    height: auto;
}

.loading-bar {
    width: 100%;
    height: 10px;
    background-color: #ccc;
    margin-top: 10px;
    border-radius: 5px;
    overflow: hidden;
}

.loading-bar .progress {
    width: 0;
    height: 100%;
    background-color: #007bff;
    animation: loading 3s linear infinite;
}

@keyframes loading {
    0% {
        width: 0;
    }
    100% {
        width: 100%;
    }
}

</style>
{% endblock %}
{% block content %}
<div class="container align-items-center mt-4">
  <nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: '-';">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('views.home') }}">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ from_country_url }}">{{ from_country_name }} {{ from_country_category.title() }}</a></li>
      <li class="breadcrumb-item active" aria-current="page"><small>{{ ' '.join(story.title.split(' ')[:5]) }}...</small></li>
    </ol>
  </nav>

  <h1 class="fs-2 fw-bold">{{ story.title }}</h1>
  <h2 class="fs-6 fw-light text-secondary-emphasis mb-3">{{ story.description|safe }}</h2>

  <small><p><a href="{{ story.link }}" target="_blank" class="text-decoration-none mb-1"> 
    Published by{% if story.publisher.favicon %}<img src="{{ story.publisher.favicon }}" class="rounded ms-1 me-1" alt="{{ story.publisher.name }} favicon image" width="24" height="24">{% else %}<i class="fa-solid fa-rss ms-1 me-1"></i>{% endif %}{{ story.publisher.name }}
  </a></p>
  
    <p class="text-body-secondary"><i class="fa-solid fa-calendar-days me-1"></i>{{ story.pub_date }}<span class="ms-1">&#x2022;</span><span class="ms-1">{{ story.clicks }} view{% if story.clicks > 1 or story.clicks == 0 %}s{% endif %}</span></p>
  </small>

  <img fetchpriority="high" src="{{ story.media_content_url }}" class="rounded my-3 news-top-image" alt="{{ story.title }}" width="500" height="333">

  {% if not story.gpt_summary %}
    <div id="maximusInitialText">
      <h3 class="mb-3">Maximus is reading the news, wait a few seconds...</h3>
    </div>

    <div id="maximusCooking">
      <img data-src="{{ url_for('static', filename='img/maximus.webp') }}" width="500" height="500" style="height: auto; width: 5vh" class="rounded-circle me-1 lazyload" alt="Maximus"><span id="maximusText">Maximus is noting some important things...</span>
    </div>
    <div class="progress">
      <div class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id="progressBar"></div>
    </div>
    
    <div id="apiResponse">
    
    </div>

    
    <div class="invisible" id="maximusFinalMessageTrue">
      <p>We are glad to help you further understand this news. You can <a href="{{ story.link }}" aria-label="Click here to visit the original story" target="_blank" class="text-decoration-none">visit the original story in {{ story.publisher.name }}</a>.</p>
      
      <div class="d-flex justify-content-between mb-3">
        {% if previous_news %}
          <a href="https://infomundi.net/comments?id={{ previous_news }}&category={{ request.args.get('category', '') }}" class="btn btn-outline-primary"><i class="fa-solid fa-backward me-1"></i>Previous News</a>
        {% endif %}

        {% if next_news %}
          <a href="https://infomundi.net/comments?id={{ next_news }}&category={{ request.args.get('category', '') }}" class="btn btn-outline-primary">Next News<i class="fa-solid fa-forward ms-1"></i></a>
        {% endif %}
      </div> 
    
    </div>

  {% else %}
    {% if story.gpt_summary %}
      
      {% for item in formatted_gpt_summary %}
        <h3>{{ item.header }}</h3>
        <p>{{ item.paragraph }}</p>
      {% endfor %}

      <div class="mt-4">
        <p>We are glad to help you further understand this news. You can <a href="{{ story.link }}" aria-label="Click here to visit the original story" target="_blank" class="text-decoration-none">visit the original story in {{ story.publisher.name }}</a>.</p>
      </div>

      <div class="d-flex justify-content-between mb-3">
        {% if previous_news %}
          <a href="https://infomundi.net/comments?id={{ previous_news }}" class="btn btn-outline-primary"><i class="fa-solid fa-backward me-1"></i>Previous News</a>
        {% endif %}

        {% if next_news %}
          <a href="https://infomundi.net/comments?id={{ next_news }}" class="btn btn-outline-primary">Next News<i class="fa-solid fa-forward ms-1"></i></a>
        {% endif %}
      </div> 

    {% else %}
      <p>{{ story.description }}</p>
      <div class="mt-4">
        <p>You can <a href="{{ story.link }}" aria-label="Click here to visit the original story" target="_blank" class="text-decoration-none">visit the original story in {{ story.publisher.name }}</a>.</p>
      </div>

      <div class="d-flex justify-content-between mb-3">
        {% if previous_news %}
          <a href="https://infomundi.net/comments?id={{ previous_news }}" class="btn btn-outline-primary"><i class="fa-solid fa-backward me-1"></i>Previous News</a>
        {% endif %}

        {% if next_news %}
          <a href="https://infomundi.net/comments?id={{ next_news }}" class="btn btn-outline-primary">Next News<i class="fa-solid fa-forward ms-1"></i></a>
        {% endif %}
      </div> 
    {% endif %}
  {% endif %}


<div class="mt-5">

<!--<script defer src="https://commento.infomundi.net/comentario.js"></script>-->
<comentario-comments auto-init="false" live-update="true" lang="{% if page_language == 'pt' %}pt-BR{% else %}{{ page_language }}{% endif %}" page-id="/comments?id={{ story.story_id }}" max-level="5" theme="{{ request.cookies.get('theme', 'light') }}"></comentario-comments>

</div>



<div class="container">
<nav aria-label="breadcrumb" style="--bs-breadcrumb-divider: '-';">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('views.home') }}">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ from_country_url }}">{{ from_country_name }} {{ from_country_category.title() }}</a></li>
      <li class="breadcrumb-item active" aria-current="page"><small>{{ ' '.join(story.title.split(' ')[:5]) }}...</small></li>
    </ol>
  </nav>
</div>

<!-- Return button -->
{% if is_mobile %}
<a type="button" class="btn btn-primary btn-sm inf-fixed-button invisible" href="{{ from_country_url }}" id="commentsReturnButtonMobile" style="position: fixed; top: 12vh; left: 20px;">
  <i class="fa-solid fa-rotate-left me-1"></i>{{ from_country_name }} {{ from_country_category.title() }}
</a>
{% else %}
<a type="button" class="btn btn-primary btn-sm inf-fixed-button" href="{{ from_country_url }}" id="commentsReturnButton" style="position: fixed; top: 12vh; left: 20px;">
  <i class="fa-solid fa-rotate-left me-1"></i>{{ from_country_name }} {{ from_country_category.title() }}
</a>
{% endif %}

{% endblock %}
{% block scripts %}

{% if not story.gpt_summary %}
<script nonce="{{ nonce }}"
  src="{{ url_for('static', filename='js/fetchGptSummary.js') }}"
></script>
{% endif %}

<script nonce="{{ nonce }}">
  window.userAuthenticated = {{ 'true' if current_user.is_authenticated else 'false' }};
</script>

<script defer nonce="{{ nonce }}" src="{{ url_for('static', filename='js/awaitLoadComentario.js') }}"></script>

<script type="application/ld+json" nonce="{{ nonce }}">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ story.title }}",
  "description": "{{ story.description }}",
  "image": "{{ story.media_content_url }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ story.publisher.name }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ story.publisher.favicon }}"
    }
  },
  "datePublished": "{{ story.pub_date.replace('/', '-') }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.url }}"
  }
}
</script>

{% endblock %}